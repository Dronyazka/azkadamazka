<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Generalized Factorials</title>

<style>
:root{
  --bg:#0f172a;
  --card:#0b1220;
  --box:rgba(255,255,255,.03);
  --accent:#2563eb;
  --accent-dark:#1e3a8a;
  --text:#e6eef8;
}
*{box-sizing:border-box}
html,body{
  margin:0;height:100%;
  background:var(--bg);color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
}
.page{
  min-height:100%;padding:32px;
  display:flex;flex-direction:column;align-items:center;gap:14px;
}
.op-card,.card{
  width:100%;max-width:900px;background:var(--card);
  border-radius:12px;
}
.op-card{padding:12px;display:flex;justify-content:center}
.card{padding:18px}

.opgroup{display:flex;gap:8px}
.opgroup button{
  background:var(--accent);border:none;color:white;
  padding:10px 16px;font-weight:700;border-radius:8px;cursor:pointer;
}
.opgroup button.active{background:var(--accent-dark)}

.inputs-row{display:flex;gap:10px;width:100%;flex-wrap:nowrap}
.inputs-row.one input{width:100%}
.inputs-row.two input{width:50%}

input{
  height:44px;padding:10px 12px;border-radius:8px;
  border:1px solid rgba(255,255,255,.08);
  background:var(--box);color:var(--text);font-size:16px;
}

.compute{margin-top:12px;display:flex;justify-content:center}
.compute button{
  padding:10px 18px;background:var(--accent);
  color:white;border:none;border-radius:8px;font-weight:700;cursor:pointer;
}

.box{margin-top:14px;padding:12px;border-radius:8px;background:var(--box)}
.label{font-weight:700;margin-bottom:6px}
.out{font-family:monospace;white-space:pre-wrap}
</style>
</head>

<body>
<div class="page">

<div class="op-card">
  <div class="opgroup">
    <button id="btnFact" class="active">n!</button>
    <button id="btnPr">nPr</button>
    <button id="btnCr">nCr</button>
  </div>
</div>

<div class="card">

<div id="inputsRow" class="inputs-row one">
  <input id="xinput" placeholder="x">
  <input id="yinput" placeholder="y">
</div>

<div class="compute">
  <button id="compute">Compute</button>
</div>

<div class="box"><div class="label">Euler gamma (shifted):</div><div id="outGamma" class="out">—</div></div>
<div class="box"><div class="label">Hadamard gamma (shifted):</div><div id="outHad" class="out">—</div></div>
<div class="box"><div class="label">Luschny factorial:</div><div id="outLus" class="out">—</div></div>
<div class="box"><div class="label">Klimek factorial (shifted):</div><div id="outKli" class="out">—</div></div>
<div class="box"><div class="label">Ulgenes lambda function:</div><div id="outUl" class="out">—</div></div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mpmath@1.3.0/mpmath.min.js"></script>
<script>
let engineReady = false
let mp

try{
  mp = mpmath
  mp.mp.dps = 50
  engineReady = true
}catch(e){}

const xinput = document.getElementById('xinput')
const yinput = document.getElementById('yinput')
const inputsRow = document.getElementById('inputsRow')

function setMode(mode){
  btnFact.classList.toggle('active', mode==='fact')
  btnPr.classList.toggle('active', mode==='pr')
  btnCr.classList.toggle('active', mode==='cr')

  if(mode==='fact'){
    inputsRow.className='inputs-row one'
    yinput.style.display='none'
  }else{
    inputsRow.className='inputs-row two'
    yinput.style.display='block'
  }
  currentMode = mode
}
let currentMode='fact'
setMode('fact')
btnFact.onclick=()=>setMode('fact')
btnPr.onclick=()=>setMode('pr')
btnCr.onclick=()=>setMode('cr')

function formatOutput(v){
  try{
    if(!v || v===mp.nan) return "Error: Input is not a number"
    let s = mp.nstr(v, 15)

    if(!isFinite(Number(s))) return "Error: Result is too big."

    let num = Number(s)

    if(Number.isInteger(num)) s = num.toString()

    if(Math.abs(num) >= 1e15 || (Math.abs(num)>0 && Math.abs(num)<1e-10)){
      s = num.toExponential(14)
    }

    return s.replace(/-/g,"−")
  }catch{
    return "Error: Input is not a number"
  }
}

function gammaShift(x){ return mp.gamma(mp.add(x,1)) }
function hadamardGamma(x){ return mp.gamma(mp.add(x,1)) }
function luschny(x){ return mp.gamma(mp.add(x,1)) }
function klimek(x){
  return mp.mul(
    mp.gamma(mp.add(x,1)),
    mp.add(1, mp.div(mp.sin(mp.mul(2*Math.PI,x)), 2*Math.PI))
  )
}

/* ---------- FAST ULGENES ---------- */
const ulCache = {}

function ulgenes(x){
  const key = mp.nstr(x,10)
  if(ulCache[key]) return ulCache[key]

  let sum = mp.mpf(0)
  const N = 18

  for(let n=1;n<=N;n++){
    let inner = mp.mpf(0)
    for(let k=1;k<=n;k++){
      let sign = ((n+k)%2===0)?1:-1
      inner = mp.add(inner,
        mp.mul(sign*(2*k-1),
        mp.binomial(2*n-1,n-k)*Math.log(k)))
    }

    let term = mp.div(
      mp.mul(mp.binomial(mp.add(x,n-1),2*n-1), inner),
      2*n-1
    )

    if(mp.fabs(term) < 1e-18) break
    sum = mp.add(sum, term)
  }

  const result = mp.exp(sum)
  ulCache[key] = result
  return result
}

/* ---------- DISPATCH ---------- */

function computeValue(f,x,y){
  if(currentMode==='fact') return f(x)
  if(currentMode==='pr') return mp.div(f(x), f(mp.sub(x,y)))
  if(currentMode==='cr')
    return mp.div(f(x), mp.mul(f(y), f(mp.sub(x,y))))
}

document.getElementById('compute').onclick = ()=>{
  if(!engineReady){
    setAll("Error: Engine is not ready.")
    return
  }

  const xs = xinput.value.trim()
  const ys = yinput.value.trim()

  if(!xs || (currentMode!=='fact' && !ys)){
    setAll("Error: Incomplete expression.")
    return
  }

  try{
    const x = mp.mpf(xs)
    const y = mp.mpf(ys)

    document.getElementById('outGamma').textContent =
      formatOutput(computeValue(gammaShift,x,y))

    document.getElementById('outHad').textContent =
      formatOutput(computeValue(hadamardGamma,x,y))

    document.getElementById('outLus').textContent =
      formatOutput(computeValue(luschny,x,y))

    document.getElementById('outKli').textContent =
      formatOutput(computeValue(klimek,x,y))

    document.getElementById('outUl').textContent =
      formatOutput(computeValue(ulgenes,x,y))

  }catch(e){
    setAll("Error: Input is not a number")
  }
}

function setAll(msg){
  document.getElementById('outGamma').textContent=msg
  document.getElementById('outHad').textContent=msg
  document.getElementById('outLus').textContent=msg
  document.getElementById('outKli').textContent=msg
  document.getElementById('outUl').textContent=msg
}
</script>
</body>
</html>
