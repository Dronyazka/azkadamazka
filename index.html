<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gamma Function Calculator</title>

<style>
html,body{
  height:100%;
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
}
.wrap{
  min-height:100%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#0f172a;
  color:#e6eef8;
}
.card{
  background:#0b1220;
  padding:28px;
  border-radius:12px;
  box-shadow:0 8px 30px rgba(2,6,23,.6);
  width:820px;
  max-width:98%;
}
.controls{
  display:flex;
  gap:8px;
  align-items:center;
}
input[type=text]{
  flex:1;
  padding:10px 12px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.06);
  background:rgba(255,255,255,.02);
  color:inherit;
  font-size:16px;
}
button{
  padding:10px 14px;
  border-radius:8px;
  border:none;
  background:#2563eb;
  color:white;
  font-weight:600;
  cursor:pointer;
  min-width:100px;
}
button:disabled{
  opacity:.5;
  cursor:not-allowed;
}
.message{
  margin-top:18px;
  padding:14px;
  border-radius:8px;
  background:rgba(255,255,255,.02);
  display:none;
  font-family:monospace;
  word-break:break-word;
  white-space:pre-wrap;
}
@media (max-width:600px){
  .controls{
    flex-direction:column;
    align-items:stretch;
  }
}
</style>
</head>

<body>
<div class="wrap">
<div class="card">

<div class="controls">
  <input id="xinput" type="text" placeholder="" />
  <button id="compute">Compute</button>
  <button id="shiftBtn">+1</button>
</div>

<div id="msg1" class="message"></div>
<div id="out1" class="message"></div>

<div id="msg2" class="message"></div>
<div id="out2" class="message"></div>

<div id="msg3" class="message"></div>
<div id="out3" class="message"></div>

</div>
</div>

<script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>

<script>
const computeBtn = document.getElementById('compute');
const shiftBtn = document.getElementById('shiftBtn');
const xinput = document.getElementById('xinput');

const msg1 = document.getElementById('msg1');
const msg2 = document.getElementById('msg2');
const msg3 = document.getElementById('msg3');

const out1 = document.getElementById('out1');
const out2 = document.getElementById('out2');
const out3 = document.getElementById('out3');

let pyodideReady = false;
let shiftMode = false;

async function initPyodide(){
  computeBtn.disabled = true;
  computeBtn.textContent = "Loading Python…";
  window.pyodide = await loadPyodide({
    indexURL:'https://cdn.jsdelivr.net/pyodide/v0.23.4/full/'
  });
  await pyodide.loadPackage(['mpmath']);
  computeBtn.disabled = false;
  computeBtn.textContent = "Compute";
  pyodideReady = true;
}
initPyodide();

shiftBtn.onclick = () => {
  shiftMode = !shiftMode;
  shiftBtn.textContent = shiftMode ? "−1" : "+1";
};

computeBtn.onclick = compute;
xinput.addEventListener("keydown", e=>{
  if(e.key==="Enter") compute();
});

async function compute(){
  if(!pyodideReady) return;
  const raw = xinput.value.trim();

  computeBtn.disabled = true;
  computeBtn.textContent = "Computing…";

  try{
    pyodide.globals.set("x_str", raw);
    pyodide.globals.set("shift_flag", shiftMode);

    const result = await pyodide.runPythonAsync(`
from mpmath import mp, gamma, digamma, sin, pi, mpc

mp.dps = 250

def format_val(v):
    if mp.isinf(v) or mp.isnan(v):
        return "∞̃"
    return mp.nstr(v, 15)

def safe_gamma(z):
    try:
        g = gamma(z)
        if mp.isinf(g) or mp.isnan(g):
            return None
        return g
    except:
        return None

try:
    x = mpc(x_str)
except:
    result = None
else:
    if shift_flag:
        x1 = x + 1

        g1 = safe_gamma(x1)
        h1 = None
        l1 = None

        if g1 is not None:
            try:
                h1 = (digamma(1 - x1/2) - digamma((1 - x1)/2)) / (2 * gamma(1 - x1))
            except:
                pass

            try:
                l1 = gamma(x1) * (1 - sin(pi*x)/(pi*x)) * (x/2 * (digamma((x+1)/2) - digamma(x/2)) - mp.mpf('1')/2)
            except:
                pass

        result = (
            "Euler gamma function (argument shifted by +1):",
            format_val(g1) if g1 else "∞̃",
            "Hadamard gamma function (argument shifted by +1):",
            format_val(h1) if h1 else "∞̃",
            "Luschny factorial:",
            format_val(l1) if l1 else "∞̃"
        )

    else:
        xm1 = x - 1

        g1 = safe_gamma(x)
        h1 = None
        l1 = None

        if g1 is not None:
            try:
                h1 = (digamma(1 - x/2) - digamma((1 - x)/2)) / (2 * gamma(1 - x))
            except:
                pass

            try:
                l1 = gamma(xm1 + 1) * (1 - sin(pi*xm1)/(pi*xm1)) * (xm1/2 * (digamma((xm1+1)/2) - digamma(xm1/2)) - mp.mpf('1')/2)
            except:
                pass

        result = (
            "Euler gamma function:",
            format_val(g1) if g1 else "∞̃",
            "Hadamard gamma function:",
            format_val(h1) if h1 else "∞̃",
            "Luschny factorial (argument shifted by −1):",
            format_val(l1) if l1 else "∞̃"
        )

result
`);

    if(!result){
      showError();
    }else{
      msg1.textContent = result[0];
      out1.textContent = result[1];
      msg2.textContent = result[2];
      out2.textContent = result[3];
      msg3.textContent = result[4];
      out3.textContent = result[5];

      msg1.style.display = out1.style.display =
      msg2.style.display = out2.style.display =
      msg3.style.display = out3.style.display = "block";
    }

  }catch(e){
    showError();
  }finally{
    computeBtn.disabled = false;
    computeBtn.textContent = "Compute";
    try{ pyodide.globals.del("x_str"); }catch{}
  }
}

function showError(){
  msg1.textContent = "Error";
  msg1.style.display = "block";
}
</script>
</body>
</html>
